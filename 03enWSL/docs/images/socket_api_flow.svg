<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 550" width="800" height="550">
  <title>Socket API Flow — Broadcast vs Multicast</title>
  <desc>Side-by-side comparison of Python socket calls for broadcast and multicast communication</desc>
  
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <polygon points="0 0, 8 3, 0 6" fill="#666"/>
    </marker>
  </defs>
  
  <!-- Background -->
  <rect width="800" height="550" fill="#fafafa"/>
  
  <!-- Title -->
  <text x="400" y="28" text-anchor="middle" font-family="Arial, sans-serif" font-size="16" font-weight="bold" fill="#333">
    Socket API Flow — Broadcast vs Multicast
  </text>
  
  <!-- Divider -->
  <line x1="400" y1="45" x2="400" y2="540" stroke="#ccc" stroke-width="2" stroke-dasharray="8,4"/>
  
  <!-- BROADCAST COLUMN -->
  <text x="200" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#E65100">
    UDP BROADCAST
  </text>
  
  <!-- Broadcast Sender -->
  <rect x="30" y="75" width="170" height="25" rx="4" fill="#FF9800" stroke="#E65100" stroke-width="1.5"/>
  <text x="115" y="92" text-anchor="middle" font-family="monospace" font-size="10" fill="white">socket(AF_INET, DGRAM)</text>
  
  <line x1="115" y1="100" x2="115" y2="115" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="30" y="120" width="170" height="35" rx="4" fill="#FFB74D" stroke="#E65100" stroke-width="1.5"/>
  <text x="115" y="135" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">setsockopt(SOL_SOCKET,</text>
  <text x="115" y="147" text-anchor="middle" font-family="monospace" font-size="9" fill="#333" font-weight="bold">SO_BROADCAST, 1)</text>
  
  <line x1="115" y1="155" x2="115" y2="170" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="30" y="175" width="170" height="25" rx="4" fill="#FFF3E0" stroke="#E65100" stroke-width="1.5"/>
  <text x="115" y="192" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">sendto(data, (BCAST, port))</text>
  
  <text x="115" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666" font-style="italic">
    BCAST = 255.255.255.255
  </text>
  
  <!-- Broadcast Receiver -->
  <rect x="220" y="75" width="160" height="25" rx="4" fill="#4CAF50" stroke="#2E7D32" stroke-width="1.5"/>
  <text x="300" y="92" text-anchor="middle" font-family="monospace" font-size="10" fill="white">socket(AF_INET, DGRAM)</text>
  
  <line x1="300" y1="100" x2="300" y2="115" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="220" y="120" width="160" height="35" rx="4" fill="#81C784" stroke="#2E7D32" stroke-width="1.5"/>
  <text x="300" y="135" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">setsockopt(SOL_SOCKET,</text>
  <text x="300" y="147" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">SO_REUSEADDR, 1)</text>
  
  <line x1="300" y1="155" x2="300" y2="170" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="220" y="175" width="160" height="25" rx="4" fill="#E8F5E9" stroke="#2E7D32" stroke-width="1.5"/>
  <text x="300" y="192" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">bind(('', port))</text>
  
  <line x1="300" y1="200" x2="300" y2="215" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="220" y="220" width="160" height="25" rx="4" fill="#C8E6C9" stroke="#2E7D32" stroke-width="1.5"/>
  <text x="300" y="237" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">recvfrom(bufsize)</text>
  
  <!-- Labels -->
  <text x="115" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#E65100" font-weight="bold">Sender</text>
  <text x="300" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#2E7D32" font-weight="bold">Receiver</text>
  
  <!-- MULTICAST COLUMN -->
  <text x="600" y="55" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1565C0">
    UDP MULTICAST
  </text>
  
  <!-- Multicast Sender -->
  <rect x="420" y="75" width="170" height="25" rx="4" fill="#2196F3" stroke="#1565C0" stroke-width="1.5"/>
  <text x="505" y="92" text-anchor="middle" font-family="monospace" font-size="10" fill="white">socket(AF_INET, DGRAM)</text>
  
  <line x1="505" y1="100" x2="505" y2="115" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="420" y="120" width="170" height="35" rx="4" fill="#64B5F6" stroke="#1565C0" stroke-width="1.5"/>
  <text x="505" y="135" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">setsockopt(IPPROTO_IP,</text>
  <text x="505" y="147" text-anchor="middle" font-family="monospace" font-size="9" fill="#333" font-weight="bold">IP_MULTICAST_TTL, ttl)</text>
  
  <line x1="505" y1="155" x2="505" y2="170" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="420" y="175" width="170" height="25" rx="4" fill="#E3F2FD" stroke="#1565C0" stroke-width="1.5"/>
  <text x="505" y="192" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">sendto(data, (MCAST, port))</text>
  
  <text x="505" y="215" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#666" font-style="italic">
    MCAST = 239.x.x.x
  </text>
  
  <!-- Multicast Receiver -->
  <rect x="610" y="75" width="170" height="25" rx="4" fill="#9C27B0" stroke="#6A1B9A" stroke-width="1.5"/>
  <text x="695" y="92" text-anchor="middle" font-family="monospace" font-size="10" fill="white">socket(AF_INET, DGRAM)</text>
  
  <line x1="695" y1="100" x2="695" y2="115" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="610" y="120" width="170" height="25" rx="4" fill="#BA68C8" stroke="#6A1B9A" stroke-width="1.5"/>
  <text x="695" y="137" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">setsockopt(SO_REUSEADDR)</text>
  
  <line x1="695" y1="145" x2="695" y2="160" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="610" y="165" width="170" height="25" rx="4" fill="#E1BEE7" stroke="#6A1B9A" stroke-width="1.5"/>
  <text x="695" y="182" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">bind(('', port))</text>
  
  <line x1="695" y1="190" x2="695" y2="205" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="610" y="210" width="170" height="45" rx="4" fill="#CE93D8" stroke="#6A1B9A" stroke-width="2"/>
  <text x="695" y="227" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">setsockopt(IPPROTO_IP,</text>
  <text x="695" y="240" text-anchor="middle" font-family="monospace" font-size="9" fill="#333" font-weight="bold">IP_ADD_MEMBERSHIP, mreq)</text>
  <text x="695" y="252" text-anchor="middle" font-family="Arial, sans-serif" font-size="8" fill="#6A1B9A">← IGMP Join sent!</text>
  
  <line x1="695" y1="255" x2="695" y2="270" stroke="#666" stroke-width="1.5" marker-end="url(#arrow)"/>
  
  <rect x="610" y="275" width="170" height="25" rx="4" fill="#F3E5F5" stroke="#6A1B9A" stroke-width="1.5"/>
  <text x="695" y="292" text-anchor="middle" font-family="monospace" font-size="9" fill="#333">recvfrom(bufsize)</text>
  
  <!-- Labels -->
  <text x="505" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1565C0" font-weight="bold">Sender</text>
  <text x="695" y="68" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#6A1B9A" font-weight="bold">Receiver</text>
  
  <!-- Key Differences Box -->
  <rect x="30" y="320" width="740" height="220" rx="8" fill="white" stroke="#ddd" stroke-width="1"/>
  <text x="400" y="345" text-anchor="middle" font-family="Arial, sans-serif" font-size="13" font-weight="bold" fill="#333">
    Key Differences
  </text>
  
  <!-- Broadcast notes -->
  <rect x="50" y="360" width="320" height="165" rx="5" fill="#FFF8E1"/>
  <text x="210" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#E65100">Broadcast</text>
  <text x="60" y="400" font-family="Arial, sans-serif" font-size="10" fill="#333">• Requires SO_BROADCAST on sender</text>
  <text x="60" y="418" font-family="Arial, sans-serif" font-size="10" fill="#333">• Receiver needs NO special options</text>
  <text x="60" y="436" font-family="Arial, sans-serif" font-size="10" fill="#333">• All hosts in L2 segment receive</text>
  <text x="60" y="454" font-family="Arial, sans-serif" font-size="10" fill="#333">• Never crosses routers (L2 only)</text>
  <text x="60" y="472" font-family="Arial, sans-serif" font-size="10" fill="#333">• Higher network overhead</text>
  <text x="60" y="495" font-family="Arial, sans-serif" font-size="9" fill="#666" font-style="italic">Use case: Service discovery, DHCP, ARP</text>
  
  <!-- Multicast notes -->
  <rect x="430" y="360" width="320" height="165" rx="5" fill="#E8EAF6"/>
  <text x="590" y="380" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" font-weight="bold" fill="#1565C0">Multicast</text>
  <text x="440" y="400" font-family="Arial, sans-serif" font-size="10" fill="#333">• Sender sets TTL for scope control</text>
  <text x="440" y="418" font-family="Arial, sans-serif" font-size="10" fill="#333">• Receiver MUST call IP_ADD_MEMBERSHIP</text>
  <text x="440" y="436" font-family="Arial, sans-serif" font-size="10" fill="#333">• Only group members receive traffic</text>
  <text x="440" y="454" font-family="Arial, sans-serif" font-size="10" fill="#333">• Can cross routers (with IGMP/PIM)</text>
  <text x="440" y="472" font-family="Arial, sans-serif" font-size="10" fill="#333">• More efficient — selective delivery</text>
  <text x="440" y="495" font-family="Arial, sans-serif" font-size="9" fill="#666" font-style="italic">Use case: Streaming, group chat, stock feeds</text>
</svg>
