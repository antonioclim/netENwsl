<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 800 350" width="800" height="350">
  <title>TCP Tunnel Architecture — Connection Flow</title>
  <desc>Diagram showing how TCP tunnel creates two separate connections</desc>
  
  <!-- Background -->
  <rect width="800" height="350" fill="#f8fafc"/>
  
  <!-- Title -->
  <text x="400" y="30" text-anchor="middle" font-family="Arial, sans-serif" font-size="18" font-weight="bold" fill="#1e293b">
    TCP Tunnel: Two Independent Connections
  </text>
  
  <!-- CLIENT -->
  <g id="client">
    <rect x="50" y="120" width="120" height="80" rx="8" fill="#dbeafe" stroke="#2563eb" stroke-width="2"/>
    <text x="110" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#1e40af">CLIENT</text>
    <text x="110" y="170" text-anchor="middle" font-family="monospace" font-size="10" fill="#3b82f6">172.20.0.100</text>
    <text x="110" y="188" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">port: 45678</text>
  </g>
  
  <!-- TUNNEL/ROUTER -->
  <g id="tunnel">
    <rect x="320" y="100" width="160" height="120" rx="8" fill="#fef3c7" stroke="#d97706" stroke-width="2"/>
    <text x="400" y="130" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#92400e">TCP TUNNEL</text>
    <text x="400" y="150" text-anchor="middle" font-family="monospace" font-size="10" fill="#b45309">172.20.0.254</text>
    
    <!-- Two ports shown -->
    <rect x="335" y="165" width="55" height="40" rx="4" fill="#fde68a" stroke="#f59e0b"/>
    <text x="362" y="182" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#92400e">Listen</text>
    <text x="362" y="197" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#78350f">:9090</text>
    
    <rect x="410" y="165" width="55" height="40" rx="4" fill="#fde68a" stroke="#f59e0b"/>
    <text x="437" y="182" text-anchor="middle" font-family="Arial, sans-serif" font-size="9" fill="#92400e">Connect</text>
    <text x="437" y="197" text-anchor="middle" font-family="monospace" font-size="10" font-weight="bold" fill="#78350f">:52341</text>
  </g>
  
  <!-- SERVER -->
  <g id="server">
    <rect x="630" y="120" width="120" height="80" rx="8" fill="#dcfce7" stroke="#16a34a" stroke-width="2"/>
    <text x="690" y="150" text-anchor="middle" font-family="Arial, sans-serif" font-size="14" font-weight="bold" fill="#166534">SERVER</text>
    <text x="690" y="170" text-anchor="middle" font-family="monospace" font-size="10" fill="#22c55e">172.20.0.10</text>
    <text x="690" y="188" text-anchor="middle" font-family="monospace" font-size="9" fill="#64748b">port: 8080</text>
  </g>
  
  <!-- Connection 1: Client to Tunnel -->
  <g id="connection1">
    <line x1="170" y1="160" x2="320" y2="160" stroke="#2563eb" stroke-width="3"/>
    <polygon points="315,155 325,160 315,165" fill="#2563eb"/>
    
    <rect x="200" y="140" width="100" height="20" rx="4" fill="#dbeafe" stroke="#93c5fd"/>
    <text x="250" y="154" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#1e40af">Connection #1</text>
    
    <!-- TCP handshake labels -->
    <text x="195" y="185" font-family="monospace" font-size="8" fill="#64748b">SYN →</text>
    <text x="275" y="185" font-family="monospace" font-size="8" fill="#64748b">← SYN-ACK</text>
  </g>
  
  <!-- Connection 2: Tunnel to Server -->
  <g id="connection2">
    <line x1="480" y1="160" x2="630" y2="160" stroke="#16a34a" stroke-width="3"/>
    <polygon points="625,155 635,160 625,165" fill="#16a34a"/>
    
    <rect x="505" y="140" width="100" height="20" rx="4" fill="#dcfce7" stroke="#86efac"/>
    <text x="555" y="154" text-anchor="middle" font-family="Arial, sans-serif" font-size="10" fill="#166534">Connection #2</text>
    
    <!-- TCP handshake labels -->
    <text x="500" y="185" font-family="monospace" font-size="8" fill="#64748b">SYN →</text>
    <text x="580" y="185" font-family="monospace" font-size="8" fill="#64748b">← SYN-ACK</text>
  </g>
  
  <!-- Data flow arrows (bidirectional) -->
  <g id="data-flow">
    <line x1="170" y1="175" x2="320" y2="175" stroke="#60a5fa" stroke-width="1" stroke-dasharray="5,3"/>
    <line x1="320" y1="178" x2="170" y2="178" stroke="#60a5fa" stroke-width="1" stroke-dasharray="5,3"/>
    
    <line x1="480" y1="175" x2="630" y2="175" stroke="#4ade80" stroke-width="1" stroke-dasharray="5,3"/>
    <line x1="630" y1="178" x2="480" y2="178" stroke="#4ade80" stroke-width="1" stroke-dasharray="5,3"/>
  </g>
  
  <!-- Key insight box -->
  <g id="insight">
    <rect x="200" y="250" width="400" height="80" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="2"/>
    <text x="400" y="275" text-anchor="middle" font-family="Arial, sans-serif" font-size="12" font-weight="bold" fill="#92400e">
      ⚠ Key Insight
    </text>
    <text x="400" y="295" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#78350f">
      The tunnel TERMINATES connection #1 and CREATES connection #2.
    </text>
    <text x="400" y="315" text-anchor="middle" font-family="Arial, sans-serif" font-size="11" fill="#78350f">
      The server sees the tunnel's IP (172.20.0.254), NOT the client's IP.
    </text>
  </g>
  
  <!-- Legend -->
  <g id="legend" transform="translate(50, 250)">
    <line x1="0" y1="10" x2="30" y2="10" stroke="#2563eb" stroke-width="3"/>
    <text x="35" y="14" font-family="Arial, sans-serif" font-size="10" fill="#64748b">TCP Connection</text>
    
    <line x1="0" y1="30" x2="30" y2="30" stroke="#60a5fa" stroke-width="1" stroke-dasharray="5,3"/>
    <text x="35" y="34" font-family="Arial, sans-serif" font-size="10" fill="#64748b">Bidirectional data</text>
  </g>
</svg>
