<?xml version="1.0" encoding="UTF-8"?>
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 600 500" font-family="Arial, sans-serif">
  <title>TCP Three-Way Handshake</title>
  <desc>Week 2 — Connection establishment sequence diagram</desc>
  
  <!-- Background -->
  <rect width="600" height="500" fill="#f8f9fa"/>
  
  <!-- Title -->
  <text x="300" y="35" text-anchor="middle" font-size="20" font-weight="bold" fill="#2c3e50">TCP Three-Way Handshake</text>
  <text x="300" y="55" text-anchor="middle" font-size="12" fill="#7f8c8d">Connection Establishment</text>
  
  <!-- Client Column -->
  <rect x="80" y="75" width="100" height="40" rx="6" fill="#3498db" stroke="#2980b9" stroke-width="2"/>
  <text x="130" y="100" text-anchor="middle" fill="white" font-weight="bold" font-size="14">Client</text>
  
  <!-- Server Column -->
  <rect x="420" y="75" width="100" height="40" rx="6" fill="#2ecc71" stroke="#27ae60" stroke-width="2"/>
  <text x="470" y="100" text-anchor="middle" fill="white" font-weight="bold" font-size="14">Server</text>
  
  <!-- Vertical lifelines -->
  <line x1="130" y1="115" x2="130" y2="420" stroke="#3498db" stroke-width="3"/>
  <line x1="470" y1="115" x2="470" y2="420" stroke="#2ecc71" stroke-width="3"/>
  
  <!-- State labels - Client -->
  <text x="50" y="145" text-anchor="middle" font-size="10" fill="#7f8c8d">CLOSED</text>
  <text x="50" y="215" text-anchor="middle" font-size="10" fill="#e74c3c">SYN_SENT</text>
  <text x="50" y="335" text-anchor="middle" font-size="10" fill="#27ae60">ESTABLISHED</text>
  
  <!-- State labels - Server -->
  <text x="550" y="145" text-anchor="middle" font-size="10" fill="#9b59b6">LISTEN</text>
  <text x="550" y="265" text-anchor="middle" font-size="10" fill="#e74c3c">SYN_RCVD</text>
  <text x="550" y="385" text-anchor="middle" font-size="10" fill="#27ae60">ESTABLISHED</text>
  
  <!-- Arrow 1: SYN -->
  <g transform="translate(0, 160)">
    <line x1="135" y1="0" x2="465" y2="50" stroke="#e74c3c" stroke-width="2" marker-end="url(#arrowRed)"/>
    <rect x="220" y="5" width="160" height="40" rx="4" fill="#e74c3c" fill-opacity="0.1" stroke="#e74c3c" stroke-width="1"/>
    <text x="300" y="22" text-anchor="middle" font-weight="bold" font-size="12" fill="#c0392b">SYN</text>
    <text x="300" y="38" text-anchor="middle" font-size="10" fill="#e74c3c">seq=x</text>
  </g>
  
  <!-- Arrow 2: SYN-ACK -->
  <g transform="translate(0, 230)">
    <line x1="465" y1="0" x2="135" y2="50" stroke="#9b59b6" stroke-width="2" marker-end="url(#arrowPurple)"/>
    <rect x="220" y="5" width="160" height="40" rx="4" fill="#9b59b6" fill-opacity="0.1" stroke="#9b59b6" stroke-width="1"/>
    <text x="300" y="22" text-anchor="middle" font-weight="bold" font-size="12" fill="#8e44ad">SYN-ACK</text>
    <text x="300" y="38" text-anchor="middle" font-size="10" fill="#9b59b6">seq=y, ack=x+1</text>
  </g>
  
  <!-- Arrow 3: ACK -->
  <g transform="translate(0, 300)">
    <line x1="135" y1="0" x2="465" y2="50" stroke="#27ae60" stroke-width="2" marker-end="url(#arrowGreen)"/>
    <rect x="220" y="5" width="160" height="40" rx="4" fill="#27ae60" fill-opacity="0.1" stroke="#27ae60" stroke-width="1"/>
    <text x="300" y="22" text-anchor="middle" font-weight="bold" font-size="12" fill="#1e8449">ACK</text>
    <text x="300" y="38" text-anchor="middle" font-size="10" fill="#27ae60">ack=y+1</text>
  </g>
  
  <!-- Connection established indicator -->
  <rect x="150" y="370" width="300" height="30" rx="4" fill="#27ae60" fill-opacity="0.2" stroke="#27ae60" stroke-width="1" stroke-dasharray="5,3"/>
  <text x="300" y="390" text-anchor="middle" font-weight="bold" font-size="12" fill="#1e8449">✓ Connection Established — Data Transfer Ready</text>
  
  <!-- Arrow markers -->
  <defs>
    <marker id="arrowRed" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#e74c3c"/>
    </marker>
    <marker id="arrowPurple" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#9b59b6"/>
    </marker>
    <marker id="arrowGreen" markerWidth="10" markerHeight="10" refX="9" refY="3" orient="auto" markerUnits="strokeWidth">
      <path d="M0,0 L0,6 L9,3 z" fill="#27ae60"/>
    </marker>
  </defs>
  
  <!-- Socket API correlation -->
  <g transform="translate(30, 430)">
    <text x="0" y="0" font-size="11" font-weight="bold" fill="#2c3e50">Socket API Correlation:</text>
    <text x="0" y="18" font-size="10" fill="#3498db">• Client: connect() triggers SYN, blocks until ACK received</text>
    <text x="0" y="34" font-size="10" fill="#2ecc71">• Server: accept() returns after handshake completes</text>
    <text x="0" y="50" font-size="10" fill="#7f8c8d">• Total packets: 3 (minimum overhead for reliable connection)</text>
  </g>
  
  <!-- Footer -->
  <text x="300" y="490" text-anchor="middle" font-size="10" fill="#7f8c8d">NETWORKING — ASE, CSIE Bucharest | Week 2: TCP Connection</text>
</svg>
