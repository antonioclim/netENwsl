# Week 1 Laboratory Container
# NETWORKING class - ASE, Informatics | by Revolvix
#
# Provides a complete networking toolkit for fundamental exercises.

# syntax=docker/dockerfile:1
FROM python:3.12-slim

LABEL maintainer="Revolvix - NETWORKING class, ASE Informatics"
LABEL description="Week 1 Computer Networks Laboratory Environment"
LABEL version="1.0.0"

# Prevent interactive prompts during package installation
ENV DEBIAN_FRONTEND=noninteractive
ENV HOME=/home/lab
ENV PYTHONDONTWRITEBYTECODE=1
ENV PYTHONUNBUFFERED=1

WORKDIR /work

# Create home directory for lab user
RUN mkdir -p /home/lab && chmod 777 /home/lab

# Install system dependencies
# - iproute2: ip command for interface/route management
# - iputils-ping: ping for connectivity testing
# - netcat-openbsd: netcat for TCP/UDP testing
# - tcpdump: packet capture utility
# - tshark: command-line Wireshark
# - dnsutils: dig, nslookup for DNS testing
# - net-tools: legacy ifconfig, netstat (for reference)
# - iperf3: bandwidth testing
# - traceroute: path discovery
# - curl, wget: HTTP testing
# - vim, nano: text editors
RUN apt-get update -y && \
    apt-get install -y --no-install-recommends \
        iproute2 \
        iputils-ping \
        netcat-openbsd \
        tcpdump \
        tshark \
        dnsutils \
        net-tools \
        iperf3 \
        traceroute \
        curl \
        wget \
        vim \
        nano \
        procps \
        less \
        file \
        ca-certificates \
    && rm -rf /var/lib/apt/lists/* \
    && apt-get clean

# Accept tshark EULA non-interactively
RUN echo "wireshark-common wireshark-common/install-setuid boolean true" | debconf-set-selections

# Pre-install Python dependencies
# These are installed during build to avoid permission issues at runtime
RUN pip install --no-cache-dir \
    python-docx \
    scapy \
    dpkt \
    requests \
    pyyaml

# Create necessary directories
RUN mkdir -p /work/artifacts /work/pcap && \
    chmod 777 /work/artifacts /work/pcap

# Create a simple welcome message
RUN echo '#!/bin/bash\n\
echo ""\n\
echo "╔═══════════════════════════════════════════════════════════╗"\n\
echo "║  Week 1: Fundamentals of Computer Networks                ║"\n\
echo "║  NETWORKING class - ASE, Informatics | by Revolvix        ║"\n\
echo "╚═══════════════════════════════════════════════════════════╝"\n\
echo ""\n\
echo "Available tools:"\n\
echo "  ip, ping, ss         - Network diagnostics"\n\
echo "  nc (netcat)          - TCP/UDP testing"\n\
echo "  tcpdump, tshark      - Packet capture"\n\
echo "  iperf3               - Bandwidth testing"\n\
echo "  python3              - Python interpreter"\n\
echo ""\n\
echo "Quick commands:"\n\
echo "  ip addr              - Show interfaces"\n\
echo "  ip route             - Show routing table"\n\
echo "  ss -tulnp            - Show listening sockets"\n\
echo "  nc -l -p 9090        - Start TCP server"\n\
echo ""\n\
' > /usr/local/bin/welcome && chmod +x /usr/local/bin/welcome

# Add welcome to bashrc
RUN echo '/usr/local/bin/welcome' >> /etc/bash.bashrc

# Set default command
CMD ["bash", "-l"]
