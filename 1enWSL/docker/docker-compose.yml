# Week 1 Laboratory - Docker Compose Configuration
# NETWORKING class - ASE, Informatics | by Revolvix
#
# This configuration provides an isolated network laboratory environment
# for fundamental networking exercises.

services:
  # Main laboratory container with networking tools
  lab:
    build:
      context: ..
      dockerfile: docker/Dockerfile.lab
    container_name: week1_lab
    hostname: netlab
    working_dir: /work
    volumes:
      - ..:/work:rw
      - ../pcap:/work/pcap:rw
      - ../artifacts:/work/artifacts:rw
    networks:
      - week1_network
    ports:
      - "9090:9090"   # TCP test server
      - "9091:9091"   # UDP test server
      - "9092:9092"   # Alternative port
    environment:
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
      - TERM=xterm-256color
      - LAB_WEEK=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    stdin_open: true
    tty: true
    restart: unless-stopped

  # Portainer for container management (optional)
  portainer:
    image: portainer/portainer-ce:latest
    container_name: week1_portainer
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
      - portainer_data:/data
    ports:
      - "9443:9443"
    restart: unless-stopped
    profiles:
      - management

networks:
  week1_network:
    name: week1_network
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.1.0/24
          gateway: 172.20.1.1

volumes:
  portainer_data:
    name: week1_portainer_data
