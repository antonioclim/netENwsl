# Week 1 Laboratory - Docker Compose Configuration
# NETWORKING class - ASE, Informatics | by Revolvix
#
# ADAPTED FOR: WSL2 + Ubuntu 22.04 + Docker (in WSL) + Portainer Global
# NOTE: Portainer is NOT included here - it runs globally on port 9000
#       Access it at http://localhost:9000 (credentials: stud/studstudstud)

services:
  # Main laboratory container with networking tools
  lab:
    build:
      context: ..
      dockerfile: docker/Dockerfile.lab
    container_name: week1_lab
    hostname: netlab
    working_dir: /work
    volumes:
      - ..:/work:rw
      - ../pcap:/work/pcap:rw
      - ../artifacts:/work/artifacts:rw
    networks:
      - week1_network
    ports:
      - "9090:9090"   # TCP test server
      - "9091:9091"   # UDP test server
      - "9092:9092"   # Alternative port
    environment:
      - PYTHONDONTWRITEBYTECODE=1
      - PYTHONUNBUFFERED=1
      - TERM=xterm-256color
      - LAB_WEEK=1
    cap_add:
      - NET_ADMIN
      - NET_RAW
    stdin_open: true
    tty: true
    restart: unless-stopped

# NOTE: Portainer is NOT defined here!
# It runs as a global service on port 9000
# Started separately with: docker start portainer
# Or deployed fresh with:
#   docker run -d -p 9000:9000 --name portainer --restart=always \
#     -v /var/run/docker.sock:/var/run/docker.sock \
#     -v portainer_data:/data portainer/portainer-ce:latest

networks:
  week1_network:
    name: week1_network
    driver: bridge
    ipam:
      config:
        - subnet: 172.20.1.0/24
          gateway: 172.20.1.1
