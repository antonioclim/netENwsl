# formative/quiz.yaml — Week 0 Formative Assessment
# Computer Networks — ASE, CSIE | by ing. dr. Antonio Clim
# Version: 1.6.0 | Date: 2026-01-25
#
# This quiz is also exported to quiz.json for LMS compatibility (Moodle/Canvas)
# Run with: python run_quiz.py
# Export to JSON: python run_quiz.py --export-json

metadata:
  week: 0
  topic: "Environment Setup and Python Networking Basics"
  version: "1.6.0"
  estimated_time: "15 minutes"
  passing_score: 70
  total_questions: 10
  bloom_levels: ["remember", "understand", "apply"]
  lo_coverage: ["LO0.1", "LO0.2", "LO0.3", "LO0.4", "LO0.5"]
  language: "en-GB"
  
  # LMS export settings
  lms_compatible: true
  supported_formats: ["yaml", "json", "moodle_xml", "qti"]

questions:
  # ═══════════════════════════════════════════════════════════════
  # REMEMBER (Bloom Level 1) — Basic recall
  # ═══════════════════════════════════════════════════════════════
  
  - id: q01
    type: multiple_choice
    bloom_level: remember
    lo_ref: "LO0.1"
    difficulty: basic
    points: 1
    stem: "What is the default port for the Portainer web interface?"
    options:
      a: "8080"
      b: "9000"
      c: "443"
      d: "3000"
    correct: b
    explanation: "Portainer uses port 9000 for HTTP access and 9443 for HTTPS."
    misconception_ref: "docs/misconceptions.md#portainer"
    feedback:
      correct: "Well done! Portainer defaults to port 9000."
      incorrect: "Review the Portainer setup section in Prerequisites.md"

  - id: q02
    type: multiple_choice
    bloom_level: remember
    lo_ref: "LO0.1"
    difficulty: basic
    points: 1
    stem: "Which command starts the Docker service in WSL2 (without systemd)?"
    options:
      a: "docker start"
      b: "systemctl start docker"
      c: "sudo service docker start"
      d: "wsl --start docker"
    correct: c
    explanation: "In WSL2 without systemd enabled, services are managed with 'sudo service <name> start'."
    misconception_ref: "docs/misconceptions.md#docker-autostart"
    feedback:
      correct: "Correct! The service command works in WSL2 without systemd."
      incorrect: "In WSL2 without systemd, use 'sudo service docker start'."

  # ═══════════════════════════════════════════════════════════════
  # UNDERSTAND (Bloom Level 2) — Comprehension
  # ═══════════════════════════════════════════════════════════════

  - id: q03
    type: multiple_choice
    bloom_level: understand
    lo_ref: "LO0.2"
    difficulty: intermediate
    points: 1
    stem: "What is the relationship between a Docker image and a container?"
    options:
      a: "They are the same thing with different names"
      b: "An image is a running instance of a container"
      c: "A container is a running instance created from an image"
      d: "Images are created by stopping containers"
    correct: c
    explanation: "An image is a read-only template (like a mould); a container is a runnable instance created from that image."
    misconception_ref: "docs/misconceptions.md#container-vs-image"
    feedback:
      correct: "Exactly! Think of images as templates and containers as instances."
      incorrect: "Review Misconception #3 in misconceptions.md"

  - id: q04
    type: multiple_choice
    bloom_level: understand
    lo_ref: "LO0.3"
    difficulty: intermediate
    points: 1
    stem: "In the command 'docker run -p 8080:80 nginx', what does 8080 represent?"
    options:
      a: "The container's internal port"
      b: "The host machine's port"
      c: "The maximum number of connections"
      d: "The nginx version number"
    correct: b
    explanation: "The format is -p HOST:CONTAINER. Here, 8080 is the host port that maps to container port 80."
    misconception_ref: "docs/misconceptions.md#port-mapping"
    feedback:
      correct: "Correct! The format is HOST:CONTAINER."
      incorrect: "Remember: -p HOST:CONTAINER. The first number is always the host port."

  - id: q05
    type: multiple_choice
    bloom_level: understand
    lo_ref: "LO0.3"
    difficulty: intermediate
    points: 1
    stem: "Why does 'curl localhost:9000' fail when run from inside an Alpine container, even though Portainer is running on the host at port 9000?"
    options:
      a: "Alpine containers don't support the curl command"
      b: "Portainer blocks access from other containers"
      c: "localhost inside a container refers to that container, not the host"
      d: "Port 9000 is reserved for system processes"
    correct: c
    explanation: "Each container has its own network namespace. 'localhost' refers to the container's own loopback. Use 'host.docker.internal' to reach the host."
    misconception_ref: "docs/misconceptions.md#localhost-container"
    feedback:
      correct: "Exactly! Each container has its own localhost."
      incorrect: "Review Misconception #6 about localhost isolation."

  # ═══════════════════════════════════════════════════════════════
  # APPLY (Bloom Level 3) — Practical application
  # ═══════════════════════════════════════════════════════════════

  - id: q06
    type: fill_blank
    bloom_level: apply
    lo_ref: "LO0.4"
    difficulty: intermediate
    points: 1
    stem: "To convert the string 'Hello' to bytes in Python, use: 'Hello'.___('utf-8')"
    correct: ["encode"]
    hint: "This method is the opposite of decode()"
    explanation: "encode() converts str to bytes; decode() converts bytes to str. This is essential for network programming."
    misconception_ref: "docs/misconceptions.md#encode-decode"
    feedback:
      correct: "Correct! encode() converts strings to bytes for network transmission."
      incorrect: "Remember: ENcode puts data ON the wire (str → bytes)."

  - id: q07
    type: fill_blank
    bloom_level: apply
    lo_ref: "LO0.4"
    difficulty: intermediate
    points: 1
    stem: "To safely decode bytes that might contain invalid UTF-8 characters, use: data.decode('utf-8', errors='___')"
    correct: ["replace", "ignore", "backslashreplace"]
    hint: "Common options: 'replace', 'ignore', or 'backslashreplace'"
    explanation: "Using errors='replace' substitutes invalid bytes with the Unicode replacement character (U+FFFD), preventing exceptions."
    misconception_ref: "docs/misconceptions.md#utf8-safety"
    feedback:
      correct: "Well done! Using error handling prevents crashes on invalid data."
      incorrect: "Without error handling, invalid UTF-8 raises UnicodeDecodeError."

  - id: q08
    type: fill_blank
    bloom_level: apply
    lo_ref: "LO0.5"
    difficulty: advanced
    points: 1
    stem: "To allow immediate port reuse after a server restart (avoiding 'Address already in use'), add before bind(): sock.setsockopt(socket.SOL_SOCKET, socket.___, 1)"
    correct: ["SO_REUSEADDR"]
    hint: "This socket option allows reusing the address"
    explanation: "SO_REUSEADDR allows binding to a port in TIME_WAIT state, which is useful during development when restarting servers frequently."
    misconception_ref: "docs/troubleshooting.md#address-in-use"
    feedback:
      correct: "Correct! SO_REUSEADDR is essential for development servers."
      incorrect: "The option is SO_REUSEADDR — it allows binding to ports in TIME_WAIT."

  - id: q09
    type: multiple_choice
    bloom_level: apply
    lo_ref: "LO0.5"
    difficulty: advanced
    points: 1
    stem: "Which struct format string correctly packs a port number (2 bytes) in network byte order (big-endian)?"
    options:
      a: "struct.pack('H', port)"
      b: "struct.pack('!H', port)"
      c: "struct.pack('h', port)"
      d: "struct.pack('I', port)"
    correct: b
    explanation: "The '!' prefix specifies network byte order (big-endian). 'H' is an unsigned short (2 bytes). Without '!', native byte order is used, which may be wrong."
    misconception_ref: "docs/parsons_problems.md#struct-format"
    feedback:
      correct: "Excellent! Always use '!' for network protocols."
      incorrect: "The '!' prefix is essential for network byte order. 'H' = unsigned short."

  - id: q10
    type: multiple_choice
    bloom_level: understand
    lo_ref: "LO0.2"
    difficulty: basic
    points: 1
    stem: "After running 'docker stop mycontainer', what happens to the container and its data?"
    options:
      a: "The container and all its data are permanently deleted"
      b: "The container enters 'Exited' state; data is preserved"
      c: "Data is automatically backed up to a volume"
      d: "The container is removed but volumes are kept"
    correct: b
    explanation: "docker stop gracefully stops a container but preserves it and its data. Use 'docker rm' to remove a stopped container."
    misconception_ref: "docs/misconceptions.md#stop-vs-rm"
    feedback:
      correct: "Correct! stop preserves the container; rm removes it."
      incorrect: "Review Misconception #4: stop ≠ delete."

# ═══════════════════════════════════════════════════════════════
# SCORING RUBRIC
# ═══════════════════════════════════════════════════════════════
scoring:
  total_points: 10
  passing_threshold: 7
  levels:
    - range: [90, 100]
      label: "Excellent"
      feedback: "Outstanding! You have a solid grasp of the lab environment. You're ready for Week 1 labs."
      action: "proceed"
    - range: [70, 89]
      label: "Good"
      feedback: "Good foundation. Review docs/misconceptions.md for the concepts you missed."
      action: "proceed_with_review"
    - range: [50, 69]
      label: "Needs Review"
      feedback: "Please revisit Prerequisites.md and complete the hands-on verification steps again."
      action: "review_required"
    - range: [0, 49]
      label: "Requires Attention"
      feedback: "Consider scheduling office hours or pairing with a classmate to work through the setup together."
      action: "remediation_required"

# ═══════════════════════════════════════════════════════════════
# LO COVERAGE SUMMARY
# ═══════════════════════════════════════════════════════════════
lo_coverage_detail:
  LO0.1:
    questions: ["q01", "q02"]
    weight: 20
  LO0.2:
    questions: ["q03", "q10"]
    weight: 20
  LO0.3:
    questions: ["q04", "q05"]
    weight: 20
  LO0.4:
    questions: ["q06", "q07"]
    weight: 20
  LO0.5:
    questions: ["q08", "q09"]
    weight: 20

# ═══════════════════════════════════════════════════════════════
# METADATA FOR ANALYTICS
# ═══════════════════════════════════════════════════════════════
analytics:
  expected_difficulty_distribution:
    basic: 3
    intermediate: 5
    advanced: 2
  target_completion_rate: 0.85
  target_average_score: 75
  discrimination_index_threshold: 0.3
