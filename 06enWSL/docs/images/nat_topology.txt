═══════════════════════════════════════════════════════════════════════════════
                    NAT/PAT LABORATORY TOPOLOGY — Week 6
═══════════════════════════════════════════════════════════════════════════════

    PRIVATE NETWORK (192.168.1.0/24)              PUBLIC NETWORK (TEST-NET-3)
    ════════════════════════════════              ════════════════════════════

    ┌─────────────────┐                           ┌─────────────────┐
    │       h1        │                           │       h3        │
    │  192.168.1.10   │                           │  203.0.113.2    │
    │   (internal)    │                           │    (server)     │
    └────────┬────────┘                           └────────┬────────┘
             │                                             │
             │                                             │
    ┌────────┴────────┐                           ┌────────┴────────┐
    │       h2        │                           │                 │
    │  192.168.1.20   │                           │                 │
    │   (internal)    │                           │                 │
    └────────┬────────┘                           │                 │
             │                                    │                 │
             │                                    │                 │
    ═════════╪════════════════════════════════════╪═════════════════
             │          ┌─────────────────┐       │
             │          │                 │       │
             └──────────┤      rnat       ├───────┘
                        │  NAT ROUTER     │
                        │                 │
                        │  eth0 ←─────────│─── 192.168.1.1 (private)
                        │  eth1 ─────────→│─── 203.0.113.1 (public)
                        │                 │
                        │  MASQUERADE     │
                        │  + conntrack    │
                        └─────────────────┘


    PACKET FLOW (h1 → h3):
    ═══════════════════════

    ┌──────────────────────────────────────────────────────────────────────┐
    │  ORIGINAL PACKET (h1 sends)                                          │
    │  ┌────────────────────────────────────────────────────────────────┐  │
    │  │  Src IP: 192.168.1.10    Src Port: 45678                       │  │
    │  │  Dst IP: 203.0.113.2     Dst Port: 5000                        │  │
    │  └────────────────────────────────────────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────────┐
    │  NAT TRANSLATION (rnat rewrites)                                     │
    │  ┌────────────────────────────────────────────────────────────────┐  │
    │  │  Src IP: 203.0.113.1     Src Port: 50001  ← translated         │  │
    │  │  Dst IP: 203.0.113.2     Dst Port: 5000   ← unchanged          │  │
    │  └────────────────────────────────────────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────┘
                                    │
                                    ▼
    ┌──────────────────────────────────────────────────────────────────────┐
    │  CONNTRACK ENTRY (stored in rnat)                                    │
    │  ┌────────────────────────────────────────────────────────────────┐  │
    │  │  tcp ESTABLISHED                                                │  │
    │  │  src=192.168.1.10 dst=203.0.113.2 sport=45678 dport=5000       │  │
    │  │  src=203.0.113.2 dst=203.0.113.1 sport=5000 dport=50001        │  │
    │  └────────────────────────────────────────────────────────────────┘  │
    └──────────────────────────────────────────────────────────────────────┘


    KEY INSIGHT:
    ════════════
    h3 sees 203.0.113.1:50001 — it has NO knowledge of 192.168.1.10

═══════════════════════════════════════════════════════════════════════════════
