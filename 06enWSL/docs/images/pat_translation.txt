═══════════════════════════════════════════════════════════════════════════════
                    PAT TRANSLATION TABLE — Week 6
═══════════════════════════════════════════════════════════════════════════════

    Multiple internal hosts sharing ONE public IP address:

    ┌───────────────────────────────────────────────────────────────────────┐
    │                         NAT ROUTER (rnat)                             │
    │                      Public IP: 203.0.113.1                           │
    │  ┌─────────────────────────────────────────────────────────────────┐  │
    │  │                    PAT TRANSLATION TABLE                         │  │
    │  │  ┌─────────────┬──────────┬─────────────┬──────────┬─────────┐  │  │
    │  │  │ Internal IP │ Int Port │ External IP │ Ext Port │  State  │  │  │
    │  │  ├─────────────┼──────────┼─────────────┼──────────┼─────────┤  │  │
    │  │  │192.168.1.10 │  45678   │203.0.113.1  │  50001   │ ESTAB   │  │  │
    │  │  │192.168.1.10 │  45679   │203.0.113.1  │  50002   │ ESTAB   │  │  │
    │  │  │192.168.1.20 │  45678   │203.0.113.1  │  50003   │ ESTAB   │  │  │
    │  │  │192.168.1.20 │  33210   │203.0.113.1  │  50004   │ NEW     │  │  │
    │  │  │192.168.1.30 │  12345   │203.0.113.1  │  50005   │ ESTAB   │  │  │
    │  │  └─────────────┴──────────┴─────────────┴──────────┴─────────┘  │  │
    │  └─────────────────────────────────────────────────────────────────┘  │
    └───────────────────────────────────────────────────────────────────────┘


    HOW PAT WORKS — Step by Step:
    ═════════════════════════════

    OUTBOUND (Internal → External):

         h1                    rnat                    Server
    192.168.1.10           203.0.113.1             203.0.113.2
         │                     │                        │
         │ SYN ───────────────►│                        │
         │ src=192.168.1.10:45678                       │
         │ dst=203.0.113.2:80                           │
         │                     │                        │
         │              [Create conntrack entry]        │
         │              [Rewrite src to 203.0.113.1:50001]
         │                     │                        │
         │                     │ SYN ──────────────────►│
         │                     │ src=203.0.113.1:50001  │
         │                     │ dst=203.0.113.2:80     │
         │                     │                        │


    INBOUND (External → Internal):

         h1                    rnat                    Server
    192.168.1.10           203.0.113.1             203.0.113.2
         │                     │                        │
         │                     │◄────────────── SYN-ACK │
         │                     │ src=203.0.113.2:80     │
         │                     │ dst=203.0.113.1:50001  │
         │                     │                        │
         │              [Lookup conntrack: 50001 → 192.168.1.10:45678]
         │              [Rewrite dst to 192.168.1.10:45678]
         │                     │                        │
         │◄─────────── SYN-ACK │                        │
         │ src=203.0.113.2:80  │                        │
         │ dst=192.168.1.10:45678                       │
         │                     │                        │


    PORT SELECTION:
    ════════════════

    ┌─────────────────────────────────────────────────────────────────────┐
    │  NAT router selects external port from available pool.              │
    │                                                                     │
    │  • May reuse original port (45678) if available                     │
    │  • Will choose different port if 45678 already in use               │
    │  • Typical range: 1024-65535 (ephemeral)                            │
    │                                                                     │
    │  ⚠️  Source port is NOT guaranteed to be preserved!                 │
    └─────────────────────────────────────────────────────────────────────┘


═══════════════════════════════════════════════════════════════════════════════
